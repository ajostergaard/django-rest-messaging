<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">

	<title>Real-time - Django Rest Messaging</title>

        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">
        <link href="../css/base.css" rel="stylesheet">
        <link href="../css/extra.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="..">Django Rest Messaging</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="..">The project</a>
                </li>
            
            
            
                <li >
                    <a href="../django-rest-messaging/">REST</a>
                </li>
            
            
            
                <li class="active">
                    <a href="./">Real-time</a>
                </li>
            
            
            
                <li >
                    <a href="../django-rest-messaging-js/">React.js</a>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                <li >
                    <a rel="next" href="../django-rest-messaging/">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../django-rest-messaging-js/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                <li>
                    <a href="https://github.com/raphaelgyory/django-rest-messaging">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#real-time-django-rest-messaging-centrifugo">Real-time: django-rest-messaging-centrifugo</a></li>
        
            <li><a href="#requirements">Requirements</a></li>
        
            <li><a href="#installation">Installation</a></li>
        
            <li><a href="#examples">Examples</a></li>
        
            <li><a href="#testing">Testing</a></li>
        
            <li><a href="#documentation">Documentation</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<div class="badges">
    <a href="http://travis-ci.org/raphaelgyory/django-rest-messaging-centrifugo">
        <img src="https://travis-ci.org/raphaelgyory/django-rest-messaging.svg?branch=master">
    </a>
    <a href="https://pypi.python.org/pypi/django-rest-messaging-centrifugo">
        <img src="https://img.shields.io/pypi/v/django-rest-messaging.svg">
    </a>
</div>

<h1 id="real-time-django-rest-messaging-centrifugo">Real-time: django-rest-messaging-centrifugo</h1>
<p>The django-rest-messaging-centrifugo module extends the django-rest-messaging module. It adds real-time messaging capabilities, by integrating django-rest-messaging and <a href="https://github.com/centrifugal/centrifugo">centrifugo</a>.</p>
<h2 id="requirements">Requirements</h2>
<ul>
<li>Python (2.7, 3.3, 3.4, 3.5)</li>
<li>Django (1.7, 1.8, 1.9)</li>
<li>DRF (2.4, 3.0, 3.1, 3.2, 3.3, 3.4)</li>
</ul>
<h2 id="installation">Installation</h2>
<h3 id="install-centrifugo">Install centrifugo</h3>
<p>Download centrifugo as expplained <a href="https://fzambia.gitbooks.io/centrifugal/content/server/start.html">here</a>, and move it to /usr/bin/. You shuold have a /usr/bin/centrifugo executable. You can now check the installation is successfull by running</p>
<pre><code class="bash">$ cd /usr/bin
$ ./centrifugo -h
</code></pre>

<h3 id="create-a-configjson-file">Create a config.json file</h3>
<p>Create a config.json file. You can copy the following one (just change the "secret" key, the other elements may be left as is). The file should be placed in a directory you have access to when launching centrifugo.</p>
<pre><code class="json"># /path/to/config.json
{
  &quot;secret&quot;: &quot;secret&quot;, # change this to an unguessable string
  &quot;anonymous&quot;: false,
  &quot;publish&quot;: false,
  &quot;watch&quot;: false,
  &quot;presence&quot;: true,
  &quot;join_leave&quot;: false,
  &quot;history_size&quot;: 0,
  &quot;history_lifetime&quot;: 0,
  &quot;namespaces&quot;: [
    {
      &quot;name&quot;: &quot;messages&quot;,
      &quot;anonymous&quot;: false
    },
    {
      &quot;name&quot;: &quot;threads&quot;,
      &quot;anonymous&quot;: false
    }
  ]
}
</code></pre>

<h3 id="launch-centrifugo">Launch centrifugo</h3>
<p>Download centrifugo as expplained <a href="https://fzambia.gitbooks.io/centrifugal/content/server/start.html">here</a>, and move it to /usr/bin/. You should have a /usr/bin/centrifugo executable. You can now check the installation is successfull by running </p>
<pre><code class="bash"># /usr/bin
# port 8802 is for example purpose only. Note that centrifugo runs by default on port 8000, which can compete with your regular Django port
$ ./centrifugo --config=/path/to/config.json --port=8802 
</code></pre>

<p>There are other command line options (address, engine etc.). See <a href="https://fzambia.gitbooks.io/centrifugal/content/server/configuration.html">here</a>.</p>
<p>For information, you can see an additionnal example of how we launched centrifugo for the tests in django-rest-messaging-centrifugo/tests/test_integration.py (in setUpClass).</p>
<h3 id="install-django-rest-messaging-centrifugo">Install django-rest-messaging-centrifugo</h3>
<pre><code class="bash">$ pip install django-rest-messaging-centrifugo
</code></pre>

<p>Add the module to the installed apps.</p>
<pre><code class="python">
# settings.py

INSTALLED_APPS=(
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.sites',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    # ...
    'rest_messaging',
    'rest_messaging_centrifugo',
)

</code></pre>

<p>Add additionnal configuration.</p>
<pre><code class="python">
# settings.py

# django-rest-messaging-centrifugo config
CENTRIFUGO_PORT = 8802 # the port on which centrifugo shall run, as set in config.json (see above)
CENTRIFUGO_MESSAGE_NAMESPACE = &quot;messages&quot; # the centrifugo message channel, do not change this value
CENTRIFUGO_THREAD_NAMESPACE = &quot;threads&quot; # the centrifugo thread channel, do not change this value
# centrifugo config
# note that the following settings refer to centrifugE_... 
# because it is the old name of the project
CENTRIFUGE_ADDRESS = 'http://localhost:{0}/'.format(CENTRIFUGO_PORT) # change this to your domain/your port in production
CENTRIFUGE_SECRET = 'secret' # change this to the key you put in config.json (see above)
CENTRIFUGE_TIMEOUT = 5 

</code></pre>

<p>Add the project's urls.</p>
<pre><code class="python">
# urls.py

urlpatterns = [
    # (...) your other urls
    # do not forget to include django-rest-messaging
    url(r'^messaging/', include('rest_messaging.urls', namespace='rest_messaging')),
    url(r'^messaging/centrifugo/', include('rest_messaging_centrifugo.urls', namespace='rest_messaging_centrifugo')),
]

</code></pre>

<h2 id="examples">Examples</h2>
<p>A full example will be available when the javascript consumer will be available. In the meantime, you can refer to the tests: django-rest-messaging-centrifugo/tests/test_integration.py and django-rest-messaging-centrifugo/tests/templates/tests/index.html go through the whole process of starting connections, identifying available channels and publishing new messages. </p>
<h2 id="testing">Testing</h2>
<p>Install testing requirements.</p>
<pre><code class="bash">$ pip install -r requirements.txt
</code></pre>

<p>Run with runtests.</p>
<pre><code class="bash">$ ./runtests.py
</code></pre>

<p>You can also use the excellent <a href="http://tox.readthedocs.org/en/latest/">tox</a> testing tool to run the tests against all supported versions of Python and Django. Install tox globally, and then simply run:</p>
<pre><code class="bash">$ tox
</code></pre>

<h2 id="documentation">Documentation</h2>
<p>The documentation of the whole project has been included in django-rest-messaging, on which the other modules rely.</p></div>
        </div>

        <script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script>
        <script src="../js/base.js"></script>
    </body>
</html>