<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">

	<title>REST - Django Rest Messaging</title>

        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">
        <link href="../css/base.css" rel="stylesheet">
        <link href="../css/extra.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="..">Django Rest Messaging</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="..">The project</a>
                </li>
            
            
            
                <li class="active">
                    <a href="./">REST</a>
                </li>
            
            
            
                <li >
                    <a href="../django-rest-messaging-centrifugo/">Real-time</a>
                </li>
            
            
            
                <li >
                    <a href="../django-rest-messaging-js/">React.js</a>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                <li >
                    <a rel="next" href="..">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../django-rest-messaging-centrifugo/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                <li>
                    <a href="https://github.com/raphaelgyory/django-rest-messaging">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#rest-django-rest-messaging">REST: django-rest-messaging</a></li>
        
            <li><a href="#requirements">Requirements</a></li>
        
            <li><a href="#installation">Installation</a></li>
        
            <li><a href="#settings">Settings</a></li>
        
            <li><a href="#entrypoints">Entrypoints</a></li>
        
            <li><a href="#testing">Testing</a></li>
        
            <li><a href="#documentation">Documentation</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<div class="badges">
    <a href="http://travis-ci.org/raphaelgyory/django-rest-messaging">
        <img src="https://travis-ci.org/raphaelgyory/django-rest-messaging.svg?branch=master">
    </a>
    <a href="https://pypi.python.org/pypi/django-rest-messaging">
        <img src="https://img.shields.io/pypi/v/django-rest-messaging.svg">
    </a>
</div>

<h1 id="rest-django-rest-messaging">REST: django-rest-messaging</h1>
<p>The django-rest-messaging module is the base of the project. It provides all the logic and entry points for the messaging service. </p>
<h2 id="requirements">Requirements</h2>
<ul>
<li>Python (2.7, 3.3, 3.4, 3.5)</li>
<li>Django (1.6, 1.7, 1.8, 1.9)</li>
<li>DRF (2.4, 3.0, 3.1, 3.2, 3.3, 3.4)</li>
</ul>
<h2 id="installation">Installation</h2>
<p>Install using <code>pip</code>...</p>
<pre><code class="bash">$ pip install django-rest-messaging
# optionnal: if you want to browse the module's entrypoints
$ pip install django-rest-swagger
</code></pre>

<p>Add the module to the installed apps.</p>
<pre><code class="python">
# settings.py

INSTALLED_APPS=(
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.sites',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    # ...
    'rest_messaging',
    # optional, if you want to browse the entrypoints
    'rest_framework_swagger',
)

</code></pre>

<p>Add the django-rest-messaging middleware to your application.</p>
<pre><code class="python">
# settings.py

MIDDLEWARE_CLASSES = (
    'django.middleware.common.CommonMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    # (...) your other middlewares
    'rest_messaging.middleware.MessagingMiddleware'
)

</code></pre>

<p>Add the project's urls.</p>
<pre><code class="python">
# urls.py

urlpatterns = [
    # (...) your other urls
    url(r'^messaging/', include('rest_messaging.urls', namespace='rest_messaging')),
    # optional, if you want to browse the entrypoints
    url(r'^docs/', include('rest_framework_swagger.urls')),
]

</code></pre>

<p>This is it. There are however a few settings you might want to change.</p>
<h2 id="settings">Settings</h2>
<p>A few settings can be configured in your project's settings.py file:</p>
<h3 id="daily-messages-limit">Daily messages limit</h3>
<p>By default, django-rest-messaging does not limit the number of messages a participant can send. You can modify this behaviour by setting settings.REST_MESSAGING_DAILY_LIMIT_CALLBACK to a function that returns the max number of messages a user can send daily. For example:</p>
<pre><code class="python">
# my_module.my_file.py
max_daily_messages(*args, **kwargs):
    &quot;&quot;&quot; 
    Your function will receive as arguments the Message (Django model) instance attributes.
    It must return an integer defining the daily limit or None. 
    &quot;&quot;&quot;
    # so for instance, if you whish to limit the number of messages to 50 every day
    return 50


# settings.py
from my_module.my_file import max_daily_messages
REST_MESSAGING_DAILY_LIMIT_CALLBACK = max_daily_messages

</code></pre>

<h3 id="filtering-participants">Filtering participants</h3>
<p>You can filter the participants that can be added to a thread. 
By default, django-rest-messaging limits the number of participants to 10. You can modify this behaviour by setting settings.REST_MESSAGING_ADD_PARTICIPANTS_CALLBACK to a function that returns the acceptable users ids. For example:</p>
<pre><code class="python">
# my_module.my_file.py
add_paricipants_filter(request, *participants_ids):
    &quot;&quot;&quot; 
    The function will receive as arguments 
    1. the request and 
    2. the ids of the participants that we try to add. 
    It must return a list containing the ids of the users that can be added in the thread. 
    &quot;&quot;&quot;
    # so for instance, if you whish to allow messaging only between staff members you could do
    valid_ids = []
    staf_ids = User.objects.filter(is_staff=True).values_list('id', flat=True)
    for id in participants_ids:
        if id in staf_ids:
            valid_ids.append(id)
    return valid_ids


# settings.py
from my_module.my_file import add_paricipants_filter
REST_MESSAGING_ADD_PARTICIPANTS_CALLBACK = add_paricipants_filter

</code></pre>

<h3 id="removing-participants">Removing participants</h3>
<p>By default, django-rest-messaging allow participants to quit a thread. It does not allow a participant to remove another participant. You can modify this behaviour by setting settings.REST_MESSAGING_REMOVE_PARTICIPANTS_CALLBACK to a function that returns True if the participant may be removed, False otherwise. For example:</p>
<pre><code class="python">
# my_module.my_file.py
remove_paricipant_filter(request, *participants_ids):
    &quot;&quot;&quot; 
    The function will receive as arguments 
    1. the request and 
    2. the participant instance we wan to remove. 
    It must return True if the participant can be remove, False otherwise. 
    &quot;&quot;&quot;
    # so for instance, if admin only should be allowed to remove a user, we could do
    if request.user.is_superuser:
        return True
    return False

# settings.py
from my_module.my_file import remove_paricipant_filter
REST_MESSAGING_REMOVE_PARTICIPANTS_CALLBACK = remove_paricipant_filter

</code></pre>

<h3 id="allowing-duplicate-threads">Allowing duplicate threads</h3>
<p>By default, django-rest-messaging will group messages involing the same participants. If one tries to create a thread involving participants that have already started a discussion, the message will be rattached to the existing thread. You can modify this behaviour by setting settings.REST_MESSAGING_THREAD_UNIQUE_FOR_ACTIVE_RECIPIENTS to False</p>
<pre><code class="python">
# settings.py
REST_MESSAGING_THREAD_UNIQUE_FOR_ACTIVE_RECIPIENTS = False

</code></pre>

<h3 id="add-information-about-participants">Add information about participants</h3>
<p>When serializing messages, django-rest-messaging will by default return them with a list containing the id of their readers. No additionnal information about these readers will be provided simply because it might not be available (ie, because the information about the User is saved in an unacessible database). You might want to change this behaviour, for instance by providing their username too. This can be done by setting settings.REST_MESSAGING_SERIALIZE_PARTICIPANTS_CALLBACK to a function that returns the desired serialized User object. The callback will be automatically called by the thread serializer, which will use it to render the information about the thread's participants. The tests.test_serializers module provides such an example:</p>
<pre><code class="python">
# this example is taken from tests.test_serializers.py
# my_module.my_file.py

class UserProfileSerializer(serializers.ModelSerializer):
    &quot;&quot;&quot; Serializer for testing purpose only (for the ThreadSerializer callback). &quot;&quot;&quot;

    image = compat_serializer_method_field('get_image')
    contact = compat_serializer_method_field('get_contact')

    class Meta:
        model = User
        fields = ('id', 'username', 'image', 'contact')

    def get_image(self, obj):
        return obj.profile.image

    def get_contact(self, obj):
        return obj.profile.contact

def _thread_serializer_callback(thread_instance):
    &quot;&quot;&quot; Shows how ThreadSerializer can get access to data about the users, beyond their simple ids. &quot;&quot;&quot;
    # we get all the participants' ids
    participants_ids = [participant.id for participant in thread_instance.participants.all()]
    # we can run the query we want usng this ids
    # here we want the users and related information
    users = User.objects.filter(id__in=participants_ids).select_related('profile')
    # we call our custom serializer
    serialized = UserProfileSerializer(users, many=True)
    return serialized.data


# settings.py
from my_module.my_file import _thread_serializer_callback
REST_MESSAGING_SERIALIZE_PARTICIPANTS_CALLBACK = _thread_serializer_callback

</code></pre>

<h2 id="entrypoints">Entrypoints</h2>
<p>Entrypoint are available through django-rest-swagger.</p>
<h2 id="testing">Testing</h2>
<p>Install testing requirements.</p>
<pre><code class="bash">$ pip install -r requirements.txt
</code></pre>

<p>Run with runtests.</p>
<pre><code class="bash">$ ./runtests.py
</code></pre>

<p>You can also use the excellent <a href="http://tox.readthedocs.org/en/latest/">tox</a> testing tool to run the tests against all supported versions of Python and Django. Install tox globally, and then simply run:</p>
<pre><code class="bash">$ tox
</code></pre>

<h2 id="documentation">Documentation</h2>
<p>To build the documentation, you'll need to install <code>mkdocs</code>.</p>
<pre><code class="bash">$ pip install mkdocs
</code></pre>

<p>To preview the documentation:</p>
<pre><code class="bash">$ mkdocs serve
Running at: http://127.0.0.1:8000/
</code></pre>

<p>To build the documentation:</p>
<pre><code class="bash">$ mkdocs build
</code></pre></div>
        </div>

        <script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script>
        <script src="../js/base.js"></script>
    </body>
</html>